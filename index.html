<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA Bridge</title>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#007bff">
</head>
<body style="font-family: sans-serif; text-align: center; padding: 20px;">
    <h2>PWA Middleman Active</h2>
    <p id="status">Ready to bridge requests...</p>

    <script>
        // Listen for messages from your main Web App
        // Listen for messages from the top-level Web App
        window.addEventListener("message", async (event) => {
			const { targetUrl, options } = event.data;
			try {
				const response = await fetch(targetUrl, {
					method: options.method || 'POST',
					headers: options.headers || {},
					body: options.body 
				});
				const result = await response.json();
				// Send the JSON object back to the main app
				event.source.postMessage({ status: 'success', data: result }, event.origin);
			} catch (err) {
				// If it's a parsing error or network error, send it back
				event.source.postMessage({ status: 'error', message: err.message }, event.origin);
			}
		});

        // Register the Service Worker for installation
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js');
        }
    </script>
</body>
</html>
